<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>My Account</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <link href="css/jquery.mmenu.all.css" rel="stylesheet">
    <link href="css/jquery.mhead.css" rel="stylesheet">
    <script src="js/sweetalert.min.js"></script>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Modernizr -->


    <style type="text/css">
        /*The major colour component style definition : To be included in all html files*/

        body {
            background-color: #d9e8f5;
        }

        .yellow-text {
            color: #ffba19;
        }

        .lightblue-text {
            color: #91bed4;
        }

        .navyblue-bg {
            background-color: #304269;
        }
    </style>


    <style>
        .mh-head {
            height: 6em;
            padding: 1.5em;
        }

        .mh-text {
            font-size: 2em;
        }

        .modal-backdrop {
            z-index: 0 !important;
        }
    </style>
</head>

<body>

    <div id="page">

        <div class="mh-head Sticky navyblue-bg" style="padding-right: 0em;">
            <span class="mh-btns-left">
                <a class="fa fa-bars" style="color:#ffba19; font-size:40px" href="#menu"></a>
            </span>
            <div class="navyblue-bg text-center">
                <img src="img/brandw.png" height="50vh">
            </div>
        </div>

        <!-- <nav id="menu">
            <ul>
                <li><a href="#">Home</a></li>
                <li><span>About us</span>
                    <ul>
                        <li><a href="#about/history">History</a></li>
                        <li><span>The team</span>
                            <ul>
                                <li><a href="#about/team/management">Management</a></li>
                                <li><a href="#about/team/sales">Sales</a></li>
                                <li><a href="#about/team/development">Development</a></li>
                            </ul>
                        </li>
                        <li><a href="#about/address">Our address</a></li>
                    </ul>
                </li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav> -->


        <nav id="menu">
            <ul>
                <li>
                    <a href="main.html">HOME</a>
                </li>
                <li>
                    <a href="library.html">LIBRARY</a>
                </li>
                <!-- <li><a href="bookmark">BOOKMARK</a></li> -->
                <li>
                    <a href="Javascript:void(0)">MY ACCOUNT</a>
                </li>
                <li>
                    <a href="contact.html">CONTACT US</a>
                </li>
            </ul>
        </nav>

        <div class="container-fluid">
            <h2>
                <center>My Account</center>
                <hr style="border:#304269 solid;">
            </h2>
            <div style="margin-top: 0.5em">
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <input type="text" id="acc-name" value="" class="phone-field form-control" placeholder="Change Name">
                        </div>
                    </div>
                    <div class="col-12" style="margin-top:-1em;">
                        <hr style="border: gray solid;">
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <input type="number" id="acc-phone" value="" class="phone-field form-control" placeholder="Change Mobile Number">
                        </div>
                    </div>
                    <div class="col-12" style="margin-top:-1em;">
                        <hr style="border: gray solid;">
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <input type="password" id="acc-old-password" value="" class="form-control" placeholder="Enter Old Password" required="">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <input type="password" id="acc-new-password" value="" class="form-control" placeholder="Enter New Password" required="">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <input type="password" id="acc-cnf-password" value="" class="form-control" placeholder="Re-Enter New Password" required="">
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-bottom:2em;">
                    <div class="col-1">
                        <div class="form-group">
                            <button type="button" id="acc-btn" class="acc-btn btn btn-info" data-toggle="modal" data-target="#verificationModal">Proceed</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>


    <!-- The OTP Verification Modal -->
    <div class="modal fade" id="verificationModal" style="z-index:99999999999999999999999">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Mobile Veification through OTP</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <h3>OTP (One Time Password) sent to Mobile Number</h3>
                    <br>
                    <h5 id="otpmobilenumber">90xxxx0099</h5>
                    <br>
                    <br>
                    <div class="row">
                        <div class="col-7">
                            <div class="form-group">
                                <input type="number" id="otpnumber" class="form-control" placeholder="Enter OTP">
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group">
                                <button type="button" id="resend-btn" class="resend-btn btn btn-danger">Resend OTP</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <!-- <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button> -->
                    <button type="button" class="verification-btn btn btn-info" id="verification-btn" data-background="false">Verify</button>
                </div>

            </div>
        </div>
    </div>

    <script type="text/javascript">


        $(document).on("click", ".acc-btn", function () {

            $flag = 1;

            if (!$("#acc-name").val().toString()) {
                $name = null;
            }
            else {
                $name = $("#acc-name").val().toString();
                swal("Name Updated", ":)", "success");

            }


            if (!$("#acc-phone").val().toString()) {
                $phone = null;
            }
            else {
                $phone = $("#acc-phone").val().toString();
            }

            if ($("#acc-old-password").val().toString()) {
                if (!$("#acc-new-password").val().toString() || !$("#acc-cnf-password").val().toString()) {
                    swal("Enter New Passwords", ":(", "warning");
                }
            }
            if (!$("#acc-new-password").val().toString() || !$("#acc-cnf-password").val().toString() || !$("#acc-old-password").val().toString()) {
                $old_pwd = null;
                $new_pwd = null;
                $cnf_pwd = null;
            }
            else {
                $old_pwd = $("#acc-old-password").val().toString();
                $new_pwd = $("#acc-new-password").val().toString();
                $cnf_pwd = $("#acc-cnf-password").val().toString();

                if ($("#acc-new-password").val().localeCompare($("#acc-cnf-password").val()) != 0) {
                    swal("Confirm New Password... Two password donot match", ":(", "warning");
                    $flag = 0;
                }
                else {
                    $flag = 1;
                }
            }

            if ($flag == 1) {

                $.ajax({
                    type: "POST",
                    url: "http://localhost/audiobook-web/api/update_info.php",
                    data: {
                        name: $name,
                        phone: $phone,
                        old_pwd: $old_pwd,
                        new_pwd: $new_pwd
                    },
                    success: function (data) {
                        console.log(data);
                        var dta = JSON.parse(data);
                        if (dta.status.localeCompare("error") == 0) {
                            swal("Invalid old password", ":(", "warning");
                        }
                        else {
                            swal("Password updated", ":)", "success");
                        }
                    },
                    error: function (data) {
                        console.log(data);
                    }
                });
            }


        });

        //resend otp
        $(document).on("click", ".resend-btn", function () {

            $flag = 1;

            if (!$("#acc-name").val().toString()) {
                $name = null;
            }
            else {
                $name = $("#acc-name").val().toString();
            }


            if (!$("#acc-phone").val().toString()) {
                $phone = null;
            }
            else {
                $phone = $("#acc-phone").val().toString();
            }

            if ($("#acc-old-password").val().toString()) {
                if (!$("#acc-new-password").val().toString() || !$("#acc-cnf-password").val().toString()) {
                    swal("Enter New Passwords", ":(", "warning");
                }
            }

            if (!$("#acc-new-password").val().toString() || !$("#acc-cnf-password").val().toString() || !$("#acc-old-password").val().toString()) {
                $old_pwd = null;
                $new_pwd = null;
                $cnf_pwd = null;
            }
            else {
                $old_pwd = $("#acc-old-password").val().toString();
                $new_pwd = $("#acc-new-password").val().toString();
                $cnf_pwd = $("#acc-cnf-password").val().toString();

                if ($("#acc-new-password").val().localeCompare($("#acc-cnf-password").val()) != 0) {
                    swal("Confirm New Password... Two password donot match", ":(", "warning");
                    $flag = 0;
                }
                else {
                    $flag = 1;
                }
            }

            if ($flag == 1) {

                $.ajax({
                    type: "POST",
                    url: "http://localhost/audiobook-web/api/update_info.php",
                    data: {
                        name: $name,
                        phone: $phone,
                        old_pwd: $old_pwd,
                        new_pwd: $new_pwd
                    },
                    success: function (data) {
                        var dta = JSON.parse(data);
                        if (dta.status.localeCompare("error") == 0) {
                            swal("Invalid old password", ":(", "warning");
                        }
                        else {
                            swal("Password updated", ":)", "success");
                        }
                    },
                    error: function (data) {
                        console.log(data);
                    }
                });
            }


        });

        //otp verification
        $(document).on("click", ".verification-btn", function () {
            alert("HHHHHHHHH");
            console.log($("#otpnumber").val());
            $.ajax({
                type: "POST",
                url: "http://localhost/audiobook-web/api/mobile_verify.php",
                data: {
                    otp: $("#otpnumber").val().toString()
                },
                success: function (data) {
                    console.log(data);
                    var dta = JSON.parse(data);
                    if (dta.status.localeCompare("timeout") == 0) {
                        swal("OTP session timed out", ":|", "warning");
                    }
                    else
                        if (dta.status.localeCompare("success") == 0) {
                            swal("Updated successfully", ":)", "success");
                            location.reload(true);
                        }
                        else
                            if (dta.status.localeCompare("error") == 0) {
                                swal("Invalid OTP", ":|", "error");
                            }
                },
                error: function (data) {
                    // console.log(data);
                }
            });

        });
    </script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.mmenu.all.js"></script>
    <script src="js/jquery.mhead.js"></script>

    <script type="text/javascript">
        //  create a menu
        $('#menu').mmenu();

        //  fire the plugin
        $('.mh-head').mhead({
            scroll: {
                hide: 0,
                show: 0,
                tolerance: 4
            },
            hamburger: {
                menu: null,
                animation: "collapse"
            }
        });

        $(".mm-navbar__title").html("Hello Monik");
    </script>
    <script src="js/jquery-2.1.4.js"></script>
    <script src="js/main.js"></script>
</body>

</html>